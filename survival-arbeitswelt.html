<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíº Survival: Arbeitswelt</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#2c3e50 0%,#3498db 100%);min-height:100vh;color:#fff}
        .container{max-width:900px;margin:0 auto;padding:15px}
        h1{text-align:center;font-size:1.5em;margin-bottom:15px}
        .screen{display:none}.screen.active{display:block}
        
        #login-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:85vh;gap:15px}
        .logo{font-size:4em;margin-bottom:10px}
        #login-screen h2{font-size:1.2em;color:#ffd700;text-align:center}
        .difficulty-select{display:flex;gap:10px;margin:15px 0;flex-wrap:wrap;justify-content:center}
        .diff-btn{padding:15px 25px;border:3px solid rgba(255,255,255,0.3);border-radius:15px;background:rgba(255,255,255,0.1);color:#fff;font-size:1em;font-weight:700;cursor:pointer;transition:all 0.3s}
        .diff-btn:hover,.diff-btn.selected{transform:scale(1.05)}
        .diff-btn.einfach{border-color:#00b894}.diff-btn.einfach.selected{background:#00b894}
        .diff-btn.mittel{border-color:#fdcb6e}.diff-btn.mittel.selected{background:#e17055}
        .diff-btn.schwer{border-color:#d63031}.diff-btn.schwer.selected{background:#d63031}
        .input-group{display:flex;flex-direction:column;gap:10px;width:100%;max-width:300px}
        .input-group input{font-size:1.1em;padding:12px 20px;border:2px solid #ffd700;border-radius:25px;text-align:center;background:rgba(255,255,255,0.1);color:#fff}
        .input-group input::placeholder{color:rgba(255,255,255,0.5)}
        .input-group input.code-input{font-size:1.4em;letter-spacing:8px;text-transform:uppercase}
        .btn-primary{font-size:1.1em;padding:15px 40px;border:none;border-radius:30px;background:linear-gradient(135deg,#e74c3c,#c0392b);color:#fff;font-weight:700;cursor:pointer;width:100%;max-width:300px}
        .btn-secondary{font-size:1em;padding:12px 30px;border:2px solid #ffd700;border-radius:25px;background:transparent;color:#ffd700;cursor:pointer;width:100%;max-width:300px}
        .divider{display:flex;align-items:center;gap:15px;width:100%;max-width:300px;margin:5px 0}
        .divider::before,.divider::after{content:'';flex:1;height:1px;background:rgba(255,255,255,0.3)}
        .error-msg{color:#ff6b6b;font-size:0.9em;margin-top:10px}
        
        #lobby-screen{text-align:center}
        .lobby-box{background:rgba(255,255,255,0.1);border-radius:20px;padding:25px;margin:20px 0}
        .lobby-code{font-size:2.5em;color:#ffd700;letter-spacing:10px;margin:10px 0}
        .diff-badge{display:inline-block;padding:8px 20px;border-radius:20px;font-weight:700;margin:10px 0}
        .diff-badge.einfach{background:#00b894}.diff-badge.mittel{background:#e17055}.diff-badge.schwer{background:#d63031}
        .waiting-players{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:20px 0}
        .waiting-player{padding:10px 15px;background:rgba(255,215,0,0.2);border-radius:20px;border:1px solid rgba(255,215,0,0.5)}
        .start-game-btn{font-size:1.2em;padding:15px 50px;border:none;border-radius:30px;background:linear-gradient(135deg,#e74c3c,#c0392b);color:#fff;font-weight:700;cursor:pointer;margin:15px 0}
        .start-game-btn:disabled{opacity:0.5;cursor:not-allowed}
        .small-btn{font-size:0.85em;padding:8px 15px;border:1px solid rgba(255,255,255,0.3);border-radius:15px;background:transparent;color:#aaa;cursor:pointer;margin:5px}
        .small-btn.danger{border-color:#e74c3c;color:#e74c3c}
        
        .game-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;padding:12px 15px;background:rgba(255,255,255,0.1);border-radius:15px;flex-wrap:wrap;gap:10px}
        .player-info{display:flex;align-items:center;gap:10px}
        .lives{font-size:1.3em}
        .timer{font-size:2em;font-weight:700;color:#00cec9}.timer.warning{color:#fdcb6e}.timer.danger{color:#e74c3c;animation:pulse 0.5s infinite}
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
        .survivors{font-size:0.9em;color:#00cec9}
        
        .quiz-section{background:rgba(255,255,255,0.05);border:2px solid rgba(255,215,0,0.3);border-radius:20px;padding:20px;margin-bottom:15px}
        .category-badge{display:inline-block;padding:5px 15px;background:rgba(255,215,0,0.2);border-radius:20px;font-size:0.85em;color:#ffd700;margin-bottom:12px}
        .question{font-size:1.2em;margin-bottom:20px;line-height:1.5}
        .answers{display:grid;grid-template-columns:1fr 1fr;gap:10px}
        @media(max-width:500px){.answers{grid-template-columns:1fr}}
        .answer-btn{padding:15px;font-size:1em;border:2px solid rgba(255,255,255,0.3);border-radius:12px;background:rgba(255,255,255,0.05);color:#fff;cursor:pointer;transition:all 0.2s}
        .answer-btn:hover:not(:disabled){background:rgba(255,215,0,0.2);border-color:#ffd700}
        .answer-btn.selected{background:rgba(108,92,231,0.4);border-color:#6c5ce7}
        .answer-btn.correct{background:rgba(0,184,148,0.7)!important;border-color:#00b894!important}
        .answer-btn.wrong{background:rgba(214,48,49,0.7)!important;border-color:#d63031!important}
        .answer-btn:disabled{cursor:not-allowed}
        
        .answer-status{text-align:center;padding:12px;margin-top:15px;border-radius:10px;font-weight:700}
        .answer-status.hidden{display:none!important}
        .answer-status.waiting{background:rgba(108,92,231,0.3);color:#a29bfe}
        .answer-status.correct{background:rgba(0,184,148,0.3);color:#55efc4}
        .answer-status.wrong{background:rgba(214,48,49,0.3);color:#ff7675}
        .answer-status.timeout{background:rgba(253,203,110,0.3);color:#fdcb6e}
        
        .players-grid{display:flex;flex-wrap:wrap;gap:6px;margin-top:15px}
        .player-chip{display:flex;align-items:center;gap:4px;padding:4px 10px;background:rgba(255,255,255,0.1);border-radius:12px;font-size:0.8em}
        .player-chip.dead{opacity:0.4;text-decoration:line-through}
        .player-chip.is-me{border:2px solid #ffd700;background:rgba(255,215,0,0.2)}
        .player-chip.answered{background:rgba(0,184,148,0.3)}
        
        #gameover-screen{text-align:center;padding:30px 20px}
        .result-icon{font-size:5em;margin-bottom:15px}
        .winners-list{background:rgba(255,215,0,0.1);border:2px solid rgba(255,215,0,0.3);border-radius:15px;padding:15px;margin:20px 0}
        .winner-item{display:flex;justify-content:space-between;padding:8px 12px;background:rgba(255,255,255,0.05);border-radius:8px;margin-bottom:6px}
        
        #eliminated-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);display:none;justify-content:center;align-items:center;z-index:200;flex-direction:column;gap:15px}
        #eliminated-overlay .skull{font-size:5em}
        #eliminated-overlay h2{color:#d63031}
        
        .connection-status{position:fixed;top:10px;right:10px;padding:5px 10px;border-radius:12px;font-size:0.75em;background:rgba(0,0,0,0.5)}
        .connection-status.connected{color:#00b894}
    </style>
</head>
<body>
    <div class="connection-status" id="connection-status">Verbinde...</div>
    <div class="container">
        <h1>üíº Survival: Arbeitswelt</h1>
        
        <div id="login-screen" class="screen active">
            <div class="logo">üíº</div>
            <h2>30 Fragen ‚Ä¢ 3 Leben ‚Ä¢ 15 Sekunden<br><small style="color:#aaa">Arbeit, Beruf & Konjunktiv II</small></h2>
            <div class="difficulty-select">
                <button class="diff-btn einfach" data-diff="einfach">üü¢ Einfach</button>
                <button class="diff-btn mittel" data-diff="mittel">üü° Mittel</button>
                <button class="diff-btn schwer" data-diff="schwer">üî¥ Schwer</button>
            </div>
            <div class="input-group">
                <input type="text" id="player-name" placeholder="Dein Name" maxlength="15">
                <input type="text" id="game-code" class="code-input" placeholder="CODE" maxlength="4">
            </div>
            <button class="btn-primary" id="join-btn">üö™ Beitreten</button>
            <div class="divider"><span>oder</span></div>
            <button class="btn-secondary" id="create-btn">üëë Neues Spiel erstellen</button>
            <div class="error-msg" id="error-msg"></div>
        </div>
        
        <div id="lobby-screen" class="screen">
            <div class="lobby-box">
                <h2>‚è≥ Warteraum</h2>
                <div class="lobby-code" id="lobby-code">CODE</div>
                <div class="diff-badge" id="diff-badge">Einfach</div>
                <div class="waiting-players" id="waiting-players"></div>
                <div id="host-controls">
                    <button class="start-game-btn" id="start-btn" disabled>‚ñ∂Ô∏è START</button>
                    <p style="color:#00b894;font-size:0.85em">üëë Du bist der Spielleiter</p>
                    <button class="small-btn danger" id="reset-btn">üîÑ Zur√ºcksetzen</button>
                </div>
                <div id="player-controls" style="display:none">
                    <p style="color:#fdcb6e">‚è≥ Warte auf Spielleiter...</p>
                </div>
            </div>
        </div>
        
        <div id="game-screen" class="screen">
            <div class="game-header">
                <div class="player-info">
                    <span class="lives" id="display-lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                </div>
                <div class="timer" id="timer">15</div>
                <div>
                    <div id="question-num">1/30</div>
                    <div class="survivors" id="survivors">üë• 0</div>
                </div>
            </div>
            <div class="quiz-section">
                <div class="category-badge" id="category"></div>
                <div class="question" id="question"></div>
                <div class="answers" id="answers"></div>
                <div class="answer-status hidden" id="answer-status"></div>
            </div>
            <div class="players-grid" id="players-grid"></div>
        </div>
        
        <div id="gameover-screen" class="screen">
            <div class="result-icon" id="result-icon">üèÜ</div>
            <h2 id="result-title">Spiel beendet!</h2>
            <div class="winners-list">
                <h3 style="color:#ffd700;margin-bottom:12px">üèÜ √úberlebende</h3>
                <div id="winners-content"></div>
            </div>
            <button class="btn-primary" id="back-btn">üè† Zur√ºck</button>
        </div>
        
        <div id="eliminated-overlay">
            <div class="skull">üíÄ</div>
            <h2>Ausgeschieden!</h2>
            <p style="color:#aaa">Du kannst weiter zuschauen</p>
            <button class="btn-secondary" id="watch-btn">üëÄ Zuschauen</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        firebase.initializeApp({
            apiKey: "AIzaSyBDChXlm34Kr7Gg0Dw458GiiwoLnWJAnxM",
            authDomain: "lern-deutsch-arash.firebaseapp.com",
            databaseURL: "https://lern-deutsch-arash-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "lern-deutsch-arash"
        });
        const db = firebase.database();
        
        const questions = {
            einfach: [
                {cat:"Wortschatz",q:"Was bedeutet 'Arbeitnehmer'?",a:["Eine Person, die arbeitet","Eine Firma","Ein Chef","Ein Kunde"],c:0},
                {cat:"Wortschatz",q:"Was ist '√úberstunden'?",a:["Mehr arbeiten als normal","Weniger arbeiten","Urlaub","Pause"],c:0},
                {cat:"Wortschatz",q:"Was ist ein 'Gehalt'?",a:["Geld f√ºr die Arbeit","Ein B√ºro","Ein Chef","Ein Praktikum"],c:0},
                {cat:"Wortschatz",q:"Was bedeutet 'k√ºndigen'?",a:["Die Arbeit beenden","Anfangen zu arbeiten","Urlaub machen","Pause machen"],c:0},
                {cat:"Wortschatz",q:"Was ist eine 'Stellenanzeige'?",a:["Jobangebot in der Zeitung","Ein B√ºro","Ein Kollege","Ein Chef"],c:0},
                {cat:"wenn-S√§tze",q:"___ du Fragen hast, kannst du mich fragen.",a:["Wenn","Wann","Als","Ob"],c:0},
                {cat:"wenn-S√§tze",q:"___ du krank bist, ruf bitte an.",a:["Wenn","Wann","Als","Weil"],c:0},
                {cat:"wenn-S√§tze",q:"___ Sie Hilfe brauchen, k√∂nnen Sie mich fragen.",a:["Wenn","Wann","Als","Ob"],c:0},
                {cat:"sollte",q:"Du ___ p√ºnktlich kommen.",a:["solltest","sollte","sollten","sollt"],c:0},
                {cat:"sollte",q:"Wir ___ mehr √ºben.",a:["sollten","solltest","sollte","sollt"],c:0},
                {cat:"sollte",q:"Er ___ fr√ºher aufstehen.",a:["sollte","solltest","sollten","sollt"],c:0},
                {cat:"Arbeit",q:"Die Arbeit beginnt ___ acht Uhr.",a:["um","in","an","auf"],c:0},
                {cat:"Arbeit",q:"Ich arbeite ___ einem B√ºro.",a:["in","auf","an","bei"],c:0},
                {cat:"Arbeit",q:"Mein Chef ___ sehr nett.",a:["ist","hat","macht","geht"],c:0},
                {cat:"Pronomen",q:"Ich helfe ___ gern. (du)",a:["dir","dich","du","dein"],c:0},
                {cat:"Pronomen",q:"Kannst du ___ das erkl√§ren? (ich)",a:["mir","mich","ich","mein"],c:0},
                {cat:"Modalverben",q:"Ich ___ heute l√§nger arbeiten.",a:["muss","musst","m√ºssen","m√ºsst"],c:0},
                {cat:"Modalverben",q:"Du ___ nicht rauchen.",a:["darfst","darf","d√ºrfen","d√ºrft"],c:0},
                {cat:"Modalverben",q:"Wir ___ nach Hause gehen.",a:["k√∂nnen","kann","kannst","k√∂nnt"],c:0},
                {cat:"Wortschatz",q:"Was ist ein 'Kollege'?",a:["Person, die mit mir arbeitet","Chef","Kunde","Praktikant"],c:0},
                {cat:"Wortschatz",q:"Was bedeutet 'Feierabend'?",a:["Ende der Arbeit","Anfang der Arbeit","Pause","Meeting"],c:0},
                {cat:"wenn-S√§tze",q:"___ du fertig bist, sag mir Bescheid.",a:["Wenn","Wann","Als","Weil"],c:0},
                {cat:"sollte",q:"Ihr ___ das Buch lesen.",a:["solltet","solltest","sollte","sollten"],c:0},
                {cat:"Arbeit",q:"Ich habe eine Besprechung ___ meinem Chef.",a:["mit","bei","von","f√ºr"],c:0},
                {cat:"Pronomen",q:"Er gibt ___ das Geld. (ich)",a:["mir","mich","ich","mein"],c:0},
                {cat:"Wortschatz",q:"Was ist 'Teilzeit'?",a:["Weniger Stunden arbeiten","Mehr arbeiten","Urlaub","√úberstunden"],c:0},
                {cat:"wenn-S√§tze",q:"___ wir Zeit haben, gehen wir essen.",a:["Wenn","Wann","Als","Ob"],c:0},
                {cat:"sollte",q:"Sie (formal) ___ den Chef fragen.",a:["sollten","solltest","sollte","sollt"],c:0},
                {cat:"Arbeit",q:"Ich schicke ___ eine E-Mail. (Sie)",a:["Ihnen","Sie","Ihr","Ihre"],c:0},
                {cat:"Modalverben",q:"Er ___ gut Deutsch sprechen.",a:["kann","k√∂nnen","kannst","k√∂nnt"],c:0}
            ],
            mittel: [
                {cat:"Konjunktiv II",q:"Du ___ mehr schlafen.",a:["solltest","sollst","sollte","sollen"],c:0},
                {cat:"Konjunktiv II",q:"Wir ___ zusammen lernen.",a:["k√∂nnten","k√∂nnen","k√∂nnte","k√∂nntest"],c:0},
                {cat:"Konjunktiv II",q:"Er ___ lieber Tee trinken.",a:["w√ºrde","werde","wird","w√ºrden"],c:0},
                {cat:"Konjunktiv II",q:"Ihr ___ einen Tisch reservieren.",a:["solltet","sollt","sollte","solltest"],c:0},
                {cat:"Konjunktiv II",q:"Sie ___ den Bus nehmen.",a:["k√∂nnte","kann","konnte","k√∂nnen"],c:0},
                {cat:"Ratschl√§ge",q:"Wenn du m√ºde bist, ___ du fr√ºher schlafen gehen.",a:["solltest","sollst","sollte","sollen"],c:0},
                {cat:"Ratschl√§ge",q:"Wenn ihr Fragen habt, ___ ihr mich anrufen.",a:["k√∂nnt","kann","k√∂nnen","k√∂nntet"],c:0},
                {cat:"Ratschl√§ge",q:"Wenn es kalt ist, ___ du eine Jacke anziehen.",a:["solltest","sollst","sollte","sollen"],c:0},
                {cat:"Modalverben Pr√§t.",q:"Ich ___ gestern nicht kommen.",a:["konnte","k√∂nnte","kann","gekonnt"],c:0},
                {cat:"Modalverben Pr√§t.",q:"Er ___ fr√ºher aufstehen.",a:["musste","m√ºsste","muss","gemusst"],c:0},
                {cat:"Modalverben Pr√§t.",q:"Wir ___ lange warten.",a:["mussten","m√ºssen","m√ºssten","gemusst"],c:0},
                {cat:"Reflexivverben",q:"Ich ___ mich auf die Arbeit vor.",a:["bereite","bereitet","bereitest","bereiten"],c:0},
                {cat:"Reflexivverben",q:"Er ___ sich √ºber den Job.",a:["freut","freue","freust","freuen"],c:0},
                {cat:"Reflexivverben",q:"Wir ___ uns f√ºr das Praktikum.",a:["interessieren","interessiert","interessiere","interessierst"],c:0},
                {cat:"Pr√§positionen",q:"Ich warte ___ den Chef.",a:["auf","f√ºr","an","√ºber"],c:0},
                {cat:"Pr√§positionen",q:"Er denkt oft ___ seine Karriere.",a:["an","auf","√ºber","f√ºr"],c:0},
                {cat:"Pr√§positionen",q:"Sie k√ºmmert sich ___ die Kunden.",a:["um","f√ºr","auf","√ºber"],c:0},
                {cat:"Arbeitswelt",q:"Wie viele Stunden arbeiten Deutsche pro Woche?",a:["41,5 Stunden","35 Stunden","50 Stunden","30 Stunden"],c:0},
                {cat:"Arbeitswelt",q:"Wie viele Urlaubstage haben deutsche Arbeitnehmer?",a:["Etwa 30 Tage","Etwa 10 Tage","Etwa 50 Tage","Etwa 5 Tage"],c:0},
                {cat:"Dativ",q:"Ich erkl√§re ___ die Aufgabe. (der Kollege)",a:["dem Kollegen","den Kollegen","der Kollege","des Kollegen"],c:0},
                {cat:"Dativ",q:"Sie gibt ___ den Bericht. (ihr Chef)",a:["ihrem Chef","ihren Chef","ihr Chef","ihres Chefs"],c:0},
                {cat:"Konjunktiv II",q:"Ich ___ gern dabei sein.",a:["w√ºrde","werde","will","wollte"],c:0},
                {cat:"Konjunktiv II",q:"Das ___ super!",a:["w√§re","ist","war","wird"],c:0},
                {cat:"Modalverben Pr√§t.",q:"Als Kind ___ ich kein Gem√ºse.",a:["mochte","mag","m√∂chte","gemocht"],c:0},
                {cat:"Reflexivverben",q:"Sie ___ sich ___ den Fehler.",a:["√§rgert...√ºber","√§rgert...auf","√§rgert...f√ºr","√§rgert...an"],c:0},
                {cat:"Pr√§positionen",q:"Wir sprechen ___ das Projekt.",a:["√ºber","von","f√ºr","mit"],c:0},
                {cat:"Arbeitswelt",q:"Was ist ein 'Vorstellungsgespr√§ch'?",a:["Interview f√ºr einen Job","Mittagspause","√úberstunden","Gehalt"],c:0},
                {cat:"Dativ",q:"Er schickt ___ eine Nachricht. (seine Chefin)",a:["seiner Chefin","seine Chefin","seinen Chefin","seines Chefin"],c:0},
                {cat:"Konjunktiv II",q:"___ Sie bitte das Fenster √∂ffnen?",a:["K√∂nnten","K√∂nnen","Konnten","K√∂nnte"],c:0},
                {cat:"Arbeitswelt",q:"Was bedeutet 'Bewerbung'?",a:["Dokumente f√ºr einen Job","Arbeitsvertrag","Gehalt","Urlaub"],c:0}
            ],
            schwer: [
                {cat:"Konjunktiv II",q:"Ich ___ gern fr√ºher gekommen. (Vergangenheit)",a:["w√§re","h√§tte","w√ºrde","bin"],c:0},
                {cat:"Konjunktiv II",q:"Das ___ ich nicht gedacht. (Vergangenheit)",a:["h√§tte","habe","hatte","w√§re"],c:0},
                {cat:"Konjunktiv II",q:"Ich ___ Sie gern beim Meeting gehabt.",a:["h√§tte","habe","hatte","w√§re"],c:0},
                {cat:"Konjunktiv II",q:"Wir ___ gern dabei gewesen.",a:["w√§ren","h√§tten","w√ºrden","sind"],c:0},
                {cat:"Konjunktiv II",q:"Das ___ nicht passieren d√ºrfen.",a:["h√§tte","hat","hatte","w√§re"],c:0},
                {cat:"H√∂flichkeit",q:"___ Sie mir bitte helfen?",a:["K√∂nnten","K√∂nnen","M√ºssen","Sollen"],c:0},
                {cat:"H√∂flichkeit",q:"Ich ___ gern eine Frage stellen.",a:["w√ºrde","werde","will","wollte"],c:0},
                {cat:"H√∂flichkeit",q:"___ du mir bitte die T√ºr √∂ffnen?",a:["K√∂nntest","Kannst","Musst","Sollst"],c:0},
                {cat:"Pronominaladverb",q:"Ich √§rgere mich √ºber die Versp√§tung. ‚Üí Ich √§rgere mich ___.",a:["dar√ºber","daran","daf√ºr","davon"],c:0},
                {cat:"Pronominaladverb",q:"Er wartet auf die Antwort. ‚Üí Er wartet ___.",a:["darauf","daran","daf√ºr","davon"],c:0},
                {cat:"Pronominaladverb",q:"Sie denkt an ihre Karriere. ‚Üí Sie denkt oft ___.",a:["daran","darauf","daf√ºr","dar√ºber"],c:0},
                {cat:"Reflexiv+Pr√§p.",q:"Wenn Sie Probleme haben, sollten Sie ___ ___ einen Experten wenden.",a:["sich an","an sich","sich zu","zu sich"],c:0},
                {cat:"Reflexiv+Pr√§p.",q:"Er ___ ___ das neue Projekt.",a:["freut sich auf","freut auf sich","sich freut auf","auf sich freut"],c:0},
                {cat:"Satzbau",q:"Welcher Satz ist korrekt?",a:["Wenn Sie Fragen haben, k√∂nnen Sie mich anrufen.","Wenn Sie haben Fragen, k√∂nnen Sie mich anrufen.","Wenn Fragen Sie haben, k√∂nnen Sie mich anrufen.","Wenn Sie Fragen haben, Sie k√∂nnen mich anrufen."],c:0},
                {cat:"Satzbau",q:"Welcher Satz ist korrekt?",a:["Es tut mir leid, dass ich zu sp√§t komme.","Es tut mir leid, das ich zu sp√§t komme.","Es mir tut leid, dass ich zu sp√§t komme.","Es tut mir leid, weil ich zu sp√§t komme."],c:0},
                {cat:"Bedauern",q:"Ich bedaure, ___ ich nicht dabei sein konnte.",a:["dass","weil","wenn","als"],c:0},
                {cat:"Bedauern",q:"Es tut mir leid, ___ das passiert ist.",a:["dass","weil","wenn","als"],c:0},
                {cat:"Arbeitswelt",q:"Was bedeutet 'Arbeitsvertrag'?",a:["Dokument √ºber Arbeitsbedingungen","Stellenanzeige","Bewerbung","Zeugnis"],c:0},
                {cat:"Arbeitswelt",q:"Was ist ein 'Lebenslauf'?",a:["Dokument mit pers√∂nlichen Daten und Erfahrung","Arbeitsvertrag","Gehalt","Urlaubsantrag"],c:0},
                {cat:"Konjunktiv II",q:"Wenn ich mehr Zeit ___, w√ºrde ich mehr lernen.",a:["h√§tte","habe","hatte","haben"],c:0},
                {cat:"Konjunktiv II",q:"Wenn er hier ___, w√ºrde er helfen.",a:["w√§re","ist","war","sein"],c:0},
                {cat:"Modalverben",q:"Er ___ den Bericht bis morgen fertig haben. (Notwendigkeit)",a:["muss","soll","kann","darf"],c:0},
                {cat:"Modalverben",q:"Sie ___ fr√ºher gehen, wenn Sie m√∂chten. (Erlaubnis)",a:["d√ºrfen","m√ºssen","sollen","k√∂nnen"],c:0},
                {cat:"Pr√§positionen",q:"Ich bedanke mich ___ Ihre Hilfe.",a:["f√ºr","√ºber","auf","an"],c:0},
                {cat:"Pr√§positionen",q:"Er beschwert sich ___ den L√§rm.",a:["√ºber","f√ºr","auf","an"],c:0},
                {cat:"Satzbau",q:"Nachdem er die E-Mail ___ hat, ruft er den Kunden an.",a:["geschrieben","schreiben","schreibt","schrieb"],c:0},
                {cat:"Satzbau",q:"Bevor sie nach Hause ___, schlie√üt sie alle Fenster.",a:["geht","gehen","ging","gegangen"],c:0},
                {cat:"H√∂flichkeit",q:"___ Sie so freundlich sein, mir zu helfen?",a:["W√ºrden","Werden","Wollen","K√∂nnen"],c:0},
                {cat:"Arbeitswelt",q:"Was bedeutet 'Probezeit'?",a:["Testphase am Anfang der Arbeit","√úberstunden","Urlaub","Gehalt"],c:0}
            ]
        };
        
        let gameCode, playerId, playerName, isHost = false, difficulty = 'einfach';
        let currentQ = -1, lives = 3, answered = false, selected = null, timerInt = null, watching = false;
        let gameRef, playersRef, allPlayers = [], evaluating = false, gameQuestions = [];
        
        function hideStatus() {
            const st = document.getElementById("answer-status");
            st.className = "answer-status hidden";
            st.textContent = "";
        }
        
        db.ref(".info/connected").on("value", s => {
            const el = document.getElementById("connection-status");
            el.textContent = s.val() ? "üü¢ Online" : "üî¥ Offline";
            el.className = "connection-status " + (s.val() ? "connected" : "disconnected");
        });
        
        document.querySelectorAll('.diff-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                difficulty = btn.dataset.diff;
            };
        });
        document.querySelector('.diff-btn.einfach').classList.add('selected');
        
        function genCode() {
            const c = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
            return Array(4).fill(0).map(() => c[Math.floor(Math.random() * c.length)]).join('');
        }
        
        function showError(m) {
            document.getElementById("error-msg").textContent = m;
            setTimeout(() => document.getElementById("error-msg").textContent = "", 3000);
        }
        
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
        
        function shuffle(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }
        
        document.getElementById("create-btn").onclick = function() {
            playerName = document.getElementById("player-name").value.trim();
            if (!playerName) { showError("Name eingeben!"); return; }
            
            gameCode = genCode();
            playerId = "host_" + Date.now();
            isHost = true;
            gameQuestions = shuffle([...questions[difficulty]]);
            
            gameRef = db.ref("arbeitswelt/" + gameCode);
            playersRef = db.ref("arbeitswelt/" + gameCode + "/players");
            
            gameRef.remove().then(() => {
                return gameRef.set({
                    status: "lobby",
                    difficulty: difficulty,
                    currentQuestion: -1,
                    questionStart: null,
                    questions: gameQuestions,
                    host: playerId
                });
            }).then(() => {
                return playersRef.child(playerId).set({
                    name: playerName,
                    lives: 3,
                    isHost: true,
                    answered: false
                });
            }).then(() => {
                playersRef.child(playerId).onDisconnect().remove();
                showLobby();
                setupListeners();
            });
        };
        
        document.getElementById("join-btn").onclick = function() {
            playerName = document.getElementById("player-name").value.trim();
            gameCode = document.getElementById("game-code").value.trim().toUpperCase();
            
            if (!playerName) { showError("Name eingeben!"); return; }
            if (!gameCode || gameCode.length !== 4) { showError("4-stelliger Code!"); return; }
            
            playerId = "p_" + Date.now() + "_" + Math.random().toString(36).substr(2, 4);
            isHost = false;
            
            gameRef = db.ref("arbeitswelt/" + gameCode);
            playersRef = db.ref("arbeitswelt/" + gameCode + "/players");
            
            gameRef.once("value").then(s => {
                if (!s.exists()) { showError("Spiel nicht gefunden!"); return Promise.reject(); }
                if (s.val().status !== "lobby") { showError("Spiel l√§uft bereits!"); return Promise.reject(); }
                
                difficulty = s.val().difficulty;
                gameQuestions = s.val().questions;
                
                return playersRef.child(playerId).set({
                    name: playerName,
                    lives: 3,
                    isHost: false,
                    answered: false
                });
            }).then(() => {
                playersRef.child(playerId).onDisconnect().remove();
                showLobby();
                setupListeners();
            }).catch(() => {});
        };
        
        document.getElementById("game-code").onkeypress = e => { if (e.key === "Enter") document.getElementById("join-btn").click(); };
        
        function showLobby() {
            showScreen("lobby-screen");
            document.getElementById("lobby-code").textContent = gameCode;
            
            const badge = document.getElementById("diff-badge");
            badge.textContent = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
            badge.className = "diff-badge " + difficulty;
            
            document.getElementById("host-controls").style.display = isHost ? "block" : "none";
            document.getElementById("player-controls").style.display = isHost ? "none" : "block";
        }
        
        function setupListeners() {
            playersRef.on("value", snap => {
                const players = [];
                snap.forEach(c => {
                    const d = c.val();
                    if (d && d.name) players.push({ id: c.key, ...d });
                });
                allPlayers = players;
                updatePlayers(players);
                checkAllAnswered();
            });
            
            gameRef.on("value", snap => {
                const game = snap.val();
                if (!game) { backToHome(); return; }
                
                if (game.status === "playing") {
                    showScreen("game-screen");
                    if (game.currentQuestion !== currentQ) {
                        hideStatus();
                        document.getElementById("answers").innerHTML = "";
                        currentQ = game.currentQuestion;
                        evaluating = false;
                        showQuestion(game.questionStart);
                    }
                } else if (game.status === "finished") {
                    endGame();
                }
            });
        }
        
        function updatePlayers(players) {
            const w = document.getElementById("waiting-players");
            w.innerHTML = players.length === 0 ? '<p style="color:#666">Warte...</p>' :
                players.map(p => `<div class="waiting-player"><span>${p.name} ${p.isHost ? 'üëë' : ''}</span></div>`).join("");
            
            document.getElementById("start-btn").disabled = players.filter(p => !p.isHost).length === 0;
            document.getElementById("survivors").textContent = `üë• ${players.filter(p => p.lives > 0).length}`;
            
            document.getElementById("players-grid").innerHTML = players.map(p => 
                `<div class="player-chip ${p.lives === 0 ? 'dead' : ''} ${p.id === playerId ? 'is-me' : ''} ${p.answered && p.lives > 0 ? 'answered' : ''}">
                    <span>${p.name}</span>
                    <span>${p.lives > 0 ? '‚ù§Ô∏è'.repeat(p.lives) : 'üíÄ'}</span>
                </div>`
            ).join("");
        }
        
        function checkAllAnswered() {
            if (evaluating || currentQ < 0) return;
            const alive = allPlayers.filter(p => p.lives > 0);
            if (alive.length > 0 && alive.every(p => p.answered)) {
                evaluating = true;
                if (timerInt) clearInterval(timerInt);
                evaluate();
            }
        }
        
        document.getElementById("start-btn").onclick = function() {
            if (!isHost) return;
            playersRef.once("value", s => {
                s.forEach(c => playersRef.child(c.key).update({ answered: false }));
                gameRef.update({ status: "playing", currentQuestion: 0, questionStart: Date.now() });
            });
        };
        
        document.getElementById("reset-btn").onclick = function() {
            if (!confirm("Zur√ºcksetzen?")) return;
            gameRef.update({ status: "lobby", currentQuestion: -1, questionStart: null });
            playersRef.once("value", s => s.forEach(c => playersRef.child(c.key).update({ lives: 3, answered: false })));
            lives = 3;
            currentQ = -1;
            watching = false;
            evaluating = false;
            hideStatus();
            document.getElementById("eliminated-overlay").style.display = "none";
            showScreen("lobby-screen");
        };
        
        document.getElementById("watch-btn").onclick = function() {
            watching = true;
            document.getElementById("eliminated-overlay").style.display = "none";
        };
        
        function showQuestion(startTime) {
            if (currentQ >= gameQuestions.length) {
                gameRef.update({ status: "finished" });
                return;
            }
            
            answered = false;
            selected = null;
            playersRef.child(playerId).update({ answered: false });
            
            const q = gameQuestions[currentQ];
            document.getElementById("question-num").textContent = `${currentQ + 1}/${gameQuestions.length}`;
            document.getElementById("category").textContent = q.cat;
            document.getElementById("question").textContent = q.q;
            updateLives();
            
            const idx = [0, 1, 2, 3];
            shuffle(idx);
            
            const ans = document.getElementById("answers");
            ans.innerHTML = "";
            idx.forEach(origIdx => {
                const btn = document.createElement("button");
                btn.className = "answer-btn";
                btn.textContent = q.a[origIdx];
                btn.dataset.origIdx = origIdx;
                btn.onclick = () => selectAnswer(btn, origIdx);
                if (watching || lives === 0) btn.disabled = true;
                ans.appendChild(btn);
            });
            
            startTimer(startTime);
        }
        
        function selectAnswer(btn, idx) {
            if (answered || lives === 0) return;
            answered = true;
            selected = idx;
            
            document.querySelectorAll(".answer-btn").forEach(b => {
                b.disabled = true;
                b.classList.remove("selected");
            });
            btn.classList.add("selected");
            
            playersRef.child(playerId).update({ answered: true });
            
            const st = document.getElementById("answer-status");
            st.className = "answer-status waiting";
            st.textContent = "‚úì Warte auf andere...";
        }
        
        function startTimer(startTime) {
            if (timerInt) clearInterval(timerInt);
            const el = document.getElementById("timer");
            
            function tick() {
                const rem = Math.max(0, 15 - Math.floor((Date.now() - startTime) / 1000));
                el.textContent = rem;
                el.className = "timer" + (rem <= 3 ? " danger" : rem <= 5 ? " warning" : "");
                
                if (rem === 0) {
                    clearInterval(timerInt);
                    if (!evaluating) {
                        evaluating = true;
                        evaluate();
                    }
                }
            }
            tick();
            timerInt = setInterval(tick, 200);
        }
        
        function evaluate() {
            const q = gameQuestions[currentQ];
            const st = document.getElementById("answer-status");
            
            document.querySelectorAll(".answer-btn").forEach(btn => {
                btn.disabled = true;
                if (parseInt(btn.dataset.origIdx) === q.c) btn.classList.add("correct");
            });
            
            if (!answered) {
                if (lives > 0) {
                    lives--;
                    playersRef.child(playerId).update({ lives });
                }
                st.className = "answer-status timeout";
                st.textContent = "‚è∞ Zeit abgelaufen!";
            } else if (selected === q.c) {
                st.className = "answer-status correct";
                st.textContent = "‚úÖ Richtig!";
            } else {
                if (lives > 0) {
                    lives--;
                    playersRef.child(playerId).update({ lives });
                }
                document.querySelectorAll(".answer-btn").forEach(btn => {
                    if (parseInt(btn.dataset.origIdx) === selected) btn.classList.add("wrong");
                });
                st.className = "answer-status wrong";
                st.textContent = lives > 0 ? `‚ùå Falsch! Noch ${lives} Leben` : "‚ùå Falsch!";
            }
            
            updateLives();
            
            if (lives === 0 && !watching) {
                setTimeout(() => {
                    document.getElementById("eliminated-overlay").style.display = "flex";
                }, 1000);
            }
            
            if (isHost) {
                setTimeout(() => {
                    playersRef.once("value", s => {
                        s.forEach(c => playersRef.child(c.key).update({ answered: false }));
                        if (currentQ + 1 >= gameQuestions.length) {
                            gameRef.update({ status: "finished" });
                        } else {
                            gameRef.update({ currentQuestion: currentQ + 1, questionStart: Date.now() });
                        }
                    });
                }, 3000);
            }
        }
        
        function updateLives() {
            document.getElementById("display-lives").textContent = lives > 0 ? "‚ù§Ô∏è".repeat(lives) + "üñ§".repeat(3 - lives) : "üíÄ";
        }
        
        function endGame() {
            if (timerInt) clearInterval(timerInt);
            document.getElementById("eliminated-overlay").style.display = "none";
            showScreen("gameover-screen");
            
            document.getElementById("result-icon").textContent = lives > 0 ? "üèÜ" : "üíÄ";
            document.getElementById("result-title").textContent = lives > 0 ? "Du hast √ºberlebt!" : "Ausgeschieden!";
            
            playersRef.once("value", s => {
                const winners = [];
                s.forEach(c => {
                    const p = c.val();
                    if (p && p.lives > 0) winners.push(p);
                });
                document.getElementById("winners-content").innerHTML = winners.length === 0 ? 
                    "<p>Niemand √ºberlebt! üíÄ</p>" :
                    winners.map(w => `<div class="winner-item"><span>${w.name}</span><span>${"‚ù§Ô∏è".repeat(w.lives)}</span></div>`).join("");
            });
        }
        
        document.getElementById("back-btn").onclick = backToHome;
        
        function backToHome() {
            if (timerInt) clearInterval(timerInt);
            if (gameRef) gameRef.off();
            if (playersRef) {
                playersRef.off();
                if (playerId) playersRef.child(playerId).remove();
            }
            gameCode = playerId = null;
            isHost = false;
            lives = 3;
            currentQ = -1;
            watching = false;
            evaluating = false;
            hideStatus();
            document.getElementById("eliminated-overlay").style.display = "none";
            showScreen("login-screen");
            document.getElementById("game-code").value = "";
        }
    });
    </script>
    <script data-goatcounter="https://aguitoo.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
