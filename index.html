<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Wer √ºberlebt? - Das Grammatik-Duell</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container { max-width: 900px; margin: 0 auto; padding: 15px; }
        
        h1 {
            text-align: center;
            font-size: 1.6em;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(255,215,0,0.5);
        }
        
        #login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 85vh;
            gap: 25px;
        }
        
        .logo { font-size: 4em; animation: pulse 2s infinite; }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        #login-screen h2 { font-size: 1.5em; color: #ffd700; }
        
        #login-screen input {
            font-size: 1.2em;
            padding: 15px 25px;
            border: 2px solid #ffd700;
            border-radius: 30px;
            width: 280px;
            text-align: center;
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        #login-screen input::placeholder { color: rgba(255,255,255,0.5); }
        
        #login-screen button {
            font-size: 1.3em;
            padding: 15px 50px;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        #login-screen button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 30px rgba(255,215,0,0.5);
        }
        
        #game-screen { display: none; }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
        }
        
        .player-info { display: flex; align-items: center; gap: 15px; }
        .player-name { font-weight: bold; color: #ffd700; }
        .lives { font-size: 1.5em; letter-spacing: 3px; }
        .progress-info { text-align: right; }
        .question-num { font-size: 1.1em; color: #ffd700; }
        .survivors { font-size: 0.9em; color: #00cec9; }
        
        .quiz-section {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,215,0,0.3);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .category-badge {
            display: inline-block;
            padding: 5px 15px;
            background: rgba(255,215,0,0.2);
            border-radius: 20px;
            font-size: 0.85em;
            color: #ffd700;
            margin-bottom: 15px;
        }
        
        .question { font-size: 1.4em; margin-bottom: 25px; line-height: 1.5; }
        
        .answers { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        
        @media (max-width: 600px) { .answers { grid-template-columns: 1fr; } }
        
        .answer-btn {
            padding: 18px 20px;
            font-size: 1.1em;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            background: rgba(255,255,255,0.05);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        
        .answer-btn:hover:not(:disabled) {
            background: rgba(255,215,0,0.2);
            border-color: #ffd700;
            transform: translateX(5px);
        }
        
        .answer-btn .letter {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            margin-right: 12px;
            font-weight: bold;
        }
        
        .answer-btn.correct {
            background: rgba(0,184,148,0.5);
            border-color: #00b894;
        }
        
        .answer-btn.wrong {
            background: rgba(214,48,49,0.5);
            border-color: #d63031;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .answer-btn:disabled { cursor: not-allowed; opacity: 0.7; }
        
        .feedback-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .feedback-box {
            text-align: center;
            padding: 40px;
            border-radius: 20px;
            animation: popIn 0.3s;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .feedback-box.correct { background: linear-gradient(135deg, #00b894, #00cec9); }
        .feedback-box.wrong { background: linear-gradient(135deg, #d63031, #e17055); }
        .feedback-box .icon { font-size: 4em; margin-bottom: 15px; }
        .feedback-box .message { font-size: 1.5em; font-weight: bold; }
        
        .live-players {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
        }
        
        .live-players h3 {
            font-size: 1em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .live-dot {
            width: 10px;
            height: 10px;
            background: #e74c3c;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .players-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .player-chip {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 0.85em;
        }
        
        .player-chip.dead { opacity: 0.4; text-decoration: line-through; }
        .player-chip.is-me { border: 2px solid #ffd700; background: rgba(255,215,0,0.2); }
        .player-chip .lives-mini { font-size: 0.9em; }
        
        #gameover-screen { display: none; text-align: center; padding: 40px 20px; }
        #gameover-screen .result-icon { font-size: 5em; margin-bottom: 20px; }
        #gameover-screen h2 { font-size: 2em; margin-bottom: 10px; }
        #gameover-screen .result-message { font-size: 1.2em; color: #aaa; margin-bottom: 30px; }
        
        .final-stats {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-row:last-child { border-bottom: none; }
        
        .winners-list {
            background: rgba(255,215,0,0.1);
            border: 2px solid rgba(255,215,0,0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .winners-list h3 { color: #ffd700; margin-bottom: 15px; }
        
        .winner-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin-bottom: 8px;
        }
        
        .play-again-btn {
            font-size: 1.2em;
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .play-again-btn:hover { transform: scale(1.05); }
        
        #eliminated-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 200;
            flex-direction: column;
            gap: 20px;
        }
        
        #eliminated-overlay .skull { font-size: 6em; }
        #eliminated-overlay h2 { font-size: 2em; color: #d63031; }
        #eliminated-overlay p { color: #aaa; }
        
        .watch-btn {
            padding: 12px 30px;
            border: 2px solid #ffd700;
            background: transparent;
            color: #ffd700;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
        }
        
        .watch-btn:hover { background: rgba(255,215,0,0.2); }
        
        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            background: rgba(0,0,0,0.5);
        }
        
        .connection-status.connected { color: #00b894; }
        .connection-status.disconnected { color: #e74c3c; }
    </style>
</head>
<body>
    <div class="connection-status" id="connection-status">Verbinde...</div>
    
    <div class="container">
        <h1>üéØ Wer √ºberlebt? - Das Grammatik-Duell</h1>
        
        <div id="login-screen">
            <div class="logo">üéØ</div>
            <h2>50 Fragen ‚Ä¢ 3 Leben ‚Ä¢ Wer √ºberlebt?</h2>
            <input type="text" id="player-name-input" placeholder="Dein Name" maxlength="15">
            <button id="start-btn">üöÄ Ich bin bereit!</button>
            <p style="color: #888; font-size: 0.9em; margin-top: 20px;">
                Themen: Reflexivverben ‚Ä¢ Verben mit Pr√§positionen<br>
                Modalverben Vergangenheit ‚Ä¢ Akkusativ/Dativ
            </p>
        </div>
        
        <div id="game-screen">
            <div class="game-header">
                <div class="player-info">
                    <span class="player-name" id="display-name"></span>
                    <span class="lives" id="display-lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                </div>
                <div class="progress-info">
                    <div class="question-num" id="question-num">Frage 1/50</div>
                    <div class="survivors" id="survivors">üë• 0 noch dabei</div>
                </div>
            </div>
            
            <div class="quiz-section">
                <div class="category-badge" id="category"></div>
                <div class="question" id="question"></div>
                <div class="answers" id="answers"></div>
            </div>
            
            <div class="live-players">
                <h3><span class="live-dot"></span> Spieler</h3>
                <div class="players-grid" id="players-grid"></div>
            </div>
        </div>
        
        <div id="gameover-screen">
            <div class="result-icon" id="result-icon">üèÜ</div>
            <h2 id="result-title">Spiel beendet!</h2>
            <p class="result-message" id="result-message"></p>
            
            <div class="final-stats">
                <div class="stat-row">
                    <span>Richtige Antworten</span>
                    <span id="stat-correct">0</span>
                </div>
                <div class="stat-row">
                    <span>Falsche Antworten</span>
                    <span id="stat-wrong">0</span>
                </div>
                <div class="stat-row">
                    <span>Verbleibende Leben</span>
                    <span id="stat-lives">0</span>
                </div>
            </div>
            
            <div class="winners-list" id="winners-list">
                <h3>üèÜ √úberlebende</h3>
                <div id="winners-content"></div>
            </div>
            
            <button class="play-again-btn" id="play-again-btn">üîÑ Nochmal spielen</button>
        </div>
        
        <div id="eliminated-overlay">
            <div class="skull">üíÄ</div>
            <h2>Ausgeschieden!</h2>
            <p>Du hast alle 3 Leben verloren.</p>
            <button class="watch-btn" id="watch-btn">üëÄ Zuschauen</button>
        </div>
        
        <div class="feedback-overlay" id="feedback-overlay">
            <div class="feedback-box" id="feedback-box">
                <div class="icon" id="feedback-icon"></div>
                <div class="message" id="feedback-message"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK - WICHTIG: Reihenfolge beachten! -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script>
    // Warte bis alles geladen ist
    document.addEventListener('DOMContentLoaded', function() {
        
        // Pr√ºfe ob Firebase verf√ºgbar ist
        if (typeof firebase === 'undefined') {
            document.getElementById("connection-status").textContent = "‚ùå Firebase fehlt";
            document.getElementById("connection-status").className = "connection-status disconnected";
            alert("Firebase konnte nicht geladen werden. Bitte Seite neu laden.");
            return;
        }
        
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBDChXlm34Kr7Gg0Dw458GiiwoLnWJAnxM",
            authDomain: "lern-deutsch-arash.firebaseapp.com",
            databaseURL: "https://lern-deutsch-arash-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "lern-deutsch-arash",
            storageBucket: "lern-deutsch-arash.firebasestorage.app",
            messagingSenderId: "845503292114",
            appId: "1:845503292114:web:f76ab5fcde1e978d00c30b"
        };
        
        // Firebase initialisieren
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // 50 Fragen
        const questions = [
            // REFLEXIVVERBEN (12)
            { category: "Reflexivverben", q: "Ich ___ mich jeden Morgen.", answers: ["wasche", "waschst", "waschen", "w√§scht"], correct: 0 },
            { category: "Reflexivverben", q: "Er ___ sich auf die Pr√ºfung vor.", answers: ["bereitet", "bereite", "bereitest", "bereiten"], correct: 0 },
            { category: "Reflexivverben", q: "Wir ___ uns √ºber das Geschenk.", answers: ["freuen", "freut", "freue", "freust"], correct: 0 },
            { category: "Reflexivverben", q: "Du musst ___ beeilen!", answers: ["dich", "sich", "mich", "uns"], correct: 0 },
            { category: "Reflexivverben", q: "Sie (Sg.) interessiert ___ f√ºr Musik.", answers: ["sich", "mich", "dich", "uns"], correct: 0 },
            { category: "Reflexivverben", q: "Ich habe ___ erk√§ltet.", answers: ["mich", "sich", "dich", "mir"], correct: 0 },
            { category: "Reflexivverben", q: "K√∂nnt ihr ___ das vorstellen?", answers: ["euch", "sich", "uns", "mir"], correct: 0 },
            { category: "Reflexivverben", q: "Er hat ___ verletzt.", answers: ["sich", "mich", "ihn", "ihm"], correct: 0 },
            { category: "Reflexivverben", q: "Wir treffen ___ um 8 Uhr.", answers: ["uns", "euch", "sich", "mich"], correct: 0 },
            { category: "Reflexivverben", q: "Ich ziehe ___ schnell an.", answers: ["mich", "mir", "sich", "dich"], correct: 0 },
            { category: "Reflexivverben", q: "Sie (Pl.) haben ___ gestritten.", answers: ["sich", "uns", "euch", "ihnen"], correct: 0 },
            { category: "Reflexivverben", q: "Setzt ___ bitte hin!", answers: ["euch", "sich", "uns", "dich"], correct: 0 },
            
            // VERBEN MIT PR√ÑPOSITIONEN (13)
            { category: "Verben mit Pr√§positionen", q: "Ich warte ___ den Bus.", answers: ["auf", "f√ºr", "an", "√ºber"], correct: 0 },
            { category: "Verben mit Pr√§positionen", q: "Er denkt oft ___ seine Familie.", answers: ["an", "auf", "√ºber", "f√ºr"], correct: 0 },
            { category: "Verben mit Pr√§positionen", q: "Sie freut sich ___ das Wochenende.", answers: ["auf", "√ºber", "f√ºr", "an"], correct: 0 },
            { category: "Verben mit Pr√§positionen", q: "Wir sprechen ___ das Problem.", answers: ["√ºber", "von", "auf", "f√ºr"], correct: 0 },
            { category: "Verben mit Pr√§positionen", q: "Ich interessiere mich ___ Sport.", answers: ["f√ºr", "an", "auf", "√ºber"], correct: 0 },
            { category: "Verben mit Pr√§positionen", q: "Er bittet mich ___ Hilfe.", answers: ["um", "f√ºr", "auf", "nach"], correct: 0 },
            { category: "Verben mit Pr√§positionen", q: "Sie √§rgert sich ___ den Fehler.", answers: ["√ºber", "auf", "f√ºr", "an"], correct: 0 },
            { category: "Verben mit Pr√§positionen", q: "Ich tr√§ume ___ einem Urlaub.", answers: ["von", "√ºber", "an", "auf"], correct: 0 },
            { category: "Verben mit Pr√§positionen", q: "Er k√ºmmert sich ___ die Kinder.", answers: ["um", "f√ºr", "auf", "√ºber"], correct: 0 },
            { category: "Verben mit Pr√§positionen", q: "Wir haben ___ dem Chef gesprochen.", answers: ["mit", "zu", "bei", "von"], correct: 0 },
            { category: "Verben mit Pr√§positionen", q: "Sie bedankt sich ___ das Geschenk.", answers: ["f√ºr", "√ºber", "auf", "um"], correct: 0 },
            { category: "Verben mit Pr√§positionen", q: "Ich habe Angst ___ Spinnen.", answers: ["vor", "von", "f√ºr", "√ºber"], correct: 0 },
            { category: "Verben mit Pr√§positionen", q: "Er verl√§sst sich ___ seine Freunde.", answers: ["auf", "an", "f√ºr", "mit"], correct: 0 },
            
            // MODALVERBEN VERGANGENHEIT (13)
            { category: "Modalverben Pr√§teritum", q: "Ich ___ gestern nicht kommen.", answers: ["konnte", "k√∂nnte", "kann", "gekonnt"], correct: 0 },
            { category: "Modalverben Pr√§teritum", q: "Er ___ fr√ºher aufstehen.", answers: ["musste", "m√ºsste", "muss", "gemusst"], correct: 0 },
            { category: "Modalverben Pr√§teritum", q: "Sie ___ als Kind nicht schwimmen.", answers: ["durfte", "d√ºrfte", "darf", "gedurft"], correct: 0 },
            { category: "Modalverben Pr√§teritum", q: "Wir ___ lange warten.", answers: ["mussten", "m√ºssen", "m√ºssten", "gemusst"], correct: 0 },
            { category: "Modalverben Pr√§teritum", q: "Ich ___ das nicht verstehen.", answers: ["konnte", "kann", "k√∂nnte", "gekonnt"], correct: 0 },
            { category: "Modalverben Pr√§teritum", q: "Er ___ immer Fu√üball spielen.", answers: ["wollte", "will", "wollten", "gewollt"], correct: 0 },
            { category: "Modalverben Pr√§teritum", q: "Du ___ das nicht tun!", answers: ["solltest", "sollst", "sollte", "gesollt"], correct: 0 },
            { category: "Modalverben Pr√§teritum", q: "Sie (Pl.) ___ nicht rauchen.", answers: ["durften", "d√ºrfen", "d√ºrften", "gedurft"], correct: 0 },
            { category: "Modalverben Pr√§teritum", q: "Als Kind ___ ich kein Gem√ºse.", answers: ["mochte", "mag", "m√∂chte", "gemocht"], correct: 0 },
            { category: "Modalverben Pr√§teritum", q: "Wir ___ fr√ºher viel reisen.", answers: ["konnten", "k√∂nnen", "k√∂nnten", "gekonnt"], correct: 0 },
            { category: "Modalverben Pr√§teritum", q: "Er ___ den Brief schreiben.", answers: ["sollte", "soll", "sollten", "gesollt"], correct: 0 },
            { category: "Modalverben Pr√§teritum", q: "Sie ___ unbedingt diesen Film sehen.", answers: ["wollte", "will", "wollten", "gewollt"], correct: 0 },
            { category: "Modalverben Pr√§teritum", q: "Ich ___ leider nicht helfen.", answers: ["konnte", "kann", "k√∂nnte", "gekonnt"], correct: 0 },
            
            // AKKUSATIV/DATIV (12)
            { category: "Akkusativ/Dativ", q: "Ich schenke ___ ein Buch.", answers: ["dir", "dich", "du", "deiner"], correct: 0 },
            { category: "Akkusativ/Dativ", q: "Er gibt ___ das Geld.", answers: ["mir", "mich", "ich", "meiner"], correct: 0 },
            { category: "Akkusativ/Dativ", q: "Sie zeigt ___ die Fotos.", answers: ["uns", "wir", "unser", "unsere"], correct: 0 },
            { category: "Akkusativ/Dativ", q: "Ich kaufe ___ Mutter Blumen.", answers: ["meiner", "meine", "meinem", "meinen"], correct: 0 },
            { category: "Akkusativ/Dativ", q: "Kannst du ___ das erkl√§ren?", answers: ["mir", "mich", "ich", "meiner"], correct: 0 },
            { category: "Akkusativ/Dativ", q: "Er bringt ___ einen Kaffee.", answers: ["ihr", "sie", "ihren", "ihre"], correct: 0 },
            { category: "Akkusativ/Dativ", q: "Ich schicke ___ eine Nachricht.", answers: ["ihm", "ihn", "er", "seiner"], correct: 0 },
            { category: "Akkusativ/Dativ", q: "Sie leiht ___ das Auto.", answers: ["ihm", "ihn", "er", "sein"], correct: 0 },
            { category: "Akkusativ/Dativ", q: "Gib ___ bitte den Stift!", answers: ["mir", "mich", "ich", "meinen"], correct: 0 },
            { category: "Akkusativ/Dativ", q: "Er hat ___ geholfen.", answers: ["mir", "mich", "ich", "meiner"], correct: 0 },
            { category: "Akkusativ/Dativ", q: "Ich bringe ___ den Kuchen.", answers: ["euch", "ihr", "euer", "eure"], correct: 0 },
            { category: "Akkusativ/Dativ", q: "Sie hat ___ das Buch empfohlen.", answers: ["uns", "wir", "unser", "unsere"], correct: 0 }
        ];
        
        // Spielstatus
        let playerName = "";
        let playerId = "";
        let lives = 3;
        let currentQuestion = 0;
        let correctAnswers = 0;
        let wrongAnswers = 0;
        let shuffledQuestions = [];
        let isWatching = false;
        
        // Verbindungsstatus
        database.ref(".info/connected").on("value", (snap) => {
            const status = document.getElementById("connection-status");
            if (snap.val() === true) {
                status.textContent = "üü¢ Online";
                status.className = "connection-status connected";
            } else {
                status.textContent = "üî¥ Offline";
                status.className = "connection-status disconnected";
            }
        });
        
        // Event Listeners
        document.getElementById("start-btn").addEventListener("click", startGame);
        document.getElementById("play-again-btn").addEventListener("click", playAgain);
        document.getElementById("watch-btn").addEventListener("click", watchGame);
        document.getElementById("player-name-input").addEventListener("keypress", (e) => {
            if (e.key === "Enter") startGame();
        });
        
        function setupPlayersListener() {
            database.ref("millionaer").on("value", (snapshot) => {
                const players = [];
                snapshot.forEach((child) => {
                    players.push({ id: child.key, ...child.val() });
                });
                updatePlayersUI(players);
            });
        }
        
        function updatePlayersUI(players) {
            const grid = document.getElementById("players-grid");
            const survivors = players.filter(p => p.lives > 0);
            
            document.getElementById("survivors").textContent = `üë• ${survivors.length} noch dabei`;
            
            players.sort((a, b) => {
                if (a.lives === 0 && b.lives > 0) return 1;
                if (a.lives > 0 && b.lives === 0) return -1;
                return b.lives - a.lives;
            });
            
            grid.innerHTML = "";
            players.forEach((player) => {
                const chip = document.createElement("div");
                chip.className = "player-chip";
                if (player.lives === 0) chip.classList.add("dead");
                if (player.id === playerId) chip.classList.add("is-me");
                
                const livesDisplay = player.lives > 0 
                    ? "‚ù§Ô∏è".repeat(player.lives) + "üñ§".repeat(3 - player.lives)
                    : "üíÄ";
                
                chip.innerHTML = `<span>${player.name}</span><span class="lives-mini">${livesDisplay}</span>`;
                grid.appendChild(chip);
            });
        }
        
        function startGame() {
            playerName = document.getElementById("player-name-input").value.trim();
            
            if (!playerName) {
                alert("Bitte gib deinen Namen ein!");
                return;
            }
            
            playerId = "player_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9);
            
            database.ref("millionaer/" + playerId).set({
                name: playerName,
                lives: 3,
                question: 0,
                timestamp: Date.now()
            });
            
            shuffledQuestions = [...questions].sort(() => Math.random() - 0.5);
            
            document.getElementById("login-screen").style.display = "none";
            document.getElementById("game-screen").style.display = "block";
            document.getElementById("display-name").textContent = playerName;
            
            setupPlayersListener();
            showQuestion();
        }
        
        function showQuestion() {
            if (currentQuestion >= shuffledQuestions.length) {
                endGame(true);
                return;
            }
            
            const q = shuffledQuestions[currentQuestion];
            
            document.getElementById("question-num").textContent = `Frage ${currentQuestion + 1}/${shuffledQuestions.length}`;
            document.getElementById("category").textContent = q.category;
            document.getElementById("question").textContent = q.q;
            
            const answersDiv = document.getElementById("answers");
            answersDiv.innerHTML = "";
            
            const letters = ["A", "B", "C", "D"];
            const shuffledAnswers = q.answers.map((a, i) => ({text: a, originalIndex: i}));
            shuffledAnswers.sort(() => Math.random() - 0.5);
            
            shuffledAnswers.forEach((answer, idx) => {
                const btn = document.createElement("button");
                btn.className = "answer-btn";
                btn.innerHTML = `<span class="letter">${letters[idx]}</span>${answer.text}`;
                btn.addEventListener("click", () => checkAnswer(btn, answer.originalIndex === q.correct));
                if (isWatching) btn.disabled = true;
                answersDiv.appendChild(btn);
            });
        }
        
        function checkAnswer(btn, isCorrect) {
            document.querySelectorAll(".answer-btn").forEach(b => b.disabled = true);
            
            const feedbackOverlay = document.getElementById("feedback-overlay");
            const feedbackBox = document.getElementById("feedback-box");
            const feedbackIcon = document.getElementById("feedback-icon");
            const feedbackMessage = document.getElementById("feedback-message");
            
            if (isCorrect) {
                btn.classList.add("correct");
                correctAnswers++;
                
                feedbackBox.className = "feedback-box correct";
                feedbackIcon.textContent = "‚úÖ";
                feedbackMessage.textContent = "Richtig!";
            } else {
                btn.classList.add("wrong");
                wrongAnswers++;
                lives--;
                
                const correctAnswer = shuffledQuestions[currentQuestion].answers[shuffledQuestions[currentQuestion].correct];
                document.querySelectorAll(".answer-btn").forEach(b => {
                    if (b.textContent.includes(correctAnswer)) {
                        b.classList.add("correct");
                    }
                });
                
                database.ref("millionaer/" + playerId + "/lives").set(lives);
                
                feedbackBox.className = "feedback-box wrong";
                feedbackIcon.textContent = "‚ùå";
                feedbackMessage.textContent = lives > 0 ? `Falsch! Noch ${lives} Leben` : "Ausgeschieden!";
            }
            
            updateLivesDisplay();
            feedbackOverlay.style.display = "flex";
            
            setTimeout(() => {
                feedbackOverlay.style.display = "none";
                
                if (lives === 0) {
                    document.getElementById("eliminated-overlay").style.display = "flex";
                } else {
                    currentQuestion++;
                    database.ref("millionaer/" + playerId + "/question").set(currentQuestion);
                    showQuestion();
                }
            }, 1200);
        }
        
        function updateLivesDisplay() {
            document.getElementById("display-lives").textContent = "‚ù§Ô∏è".repeat(lives) + "üñ§".repeat(3 - lives);
        }
        
        function watchGame() {
            isWatching = true;
            document.getElementById("eliminated-overlay").style.display = "none";
            currentQuestion++;
            showQuestion();
        }
        
        function endGame(survived) {
            document.getElementById("game-screen").style.display = "none";
            document.getElementById("gameover-screen").style.display = "block";
            
            if (survived && lives > 0) {
                document.getElementById("result-icon").textContent = "üèÜ";
                document.getElementById("result-title").textContent = "Du hast √ºberlebt!";
                document.getElementById("result-message").textContent = "Gl√ºckwunsch! Du hast alle 50 Fragen geschafft!";
            } else {
                document.getElementById("result-icon").textContent = "üíÄ";
                document.getElementById("result-title").textContent = "Ausgeschieden!";
                document.getElementById("result-message").textContent = `Du hast bei Frage ${currentQuestion + 1} alle Leben verloren.`;
            }
            
            document.getElementById("stat-correct").textContent = correctAnswers;
            document.getElementById("stat-wrong").textContent = wrongAnswers;
            document.getElementById("stat-lives").textContent = lives > 0 ? "‚ù§Ô∏è".repeat(lives) : "üíÄ";
            
            database.ref("millionaer").orderByChild("lives").once("value", (snapshot) => {
                const winners = [];
                snapshot.forEach((child) => {
                    const p = child.val();
                    if (p.lives > 0) winners.push(p);
                });
                
                const winnersContent = document.getElementById("winners-content");
                winnersContent.innerHTML = winners.length === 0 
                    ? "<p>Niemand hat √ºberlebt! üíÄ</p>"
                    : winners.map(w => `<div class="winner-item"><span>${w.name}</span><span>${"‚ù§Ô∏è".repeat(w.lives)}</span></div>`).join("");
            });
        }
        
        function playAgain() {
            lives = 3;
            currentQuestion = 0;
            correctAnswers = 0;
            wrongAnswers = 0;
            isWatching = false;
            
            shuffledQuestions = [...questions].sort(() => Math.random() - 0.5);
            
            database.ref("millionaer/" + playerId).update({ lives: 3, question: 0 });
            
            document.getElementById("gameover-screen").style.display = "none";
            document.getElementById("eliminated-overlay").style.display = "none";
            document.getElementById("game-screen").style.display = "block";
            updateLivesDisplay();
            showQuestion();
        }
        
    }); // Ende DOMContentLoaded
    </script>
    
    <script data-goatcounter="https://aguitoo.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
